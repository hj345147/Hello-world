<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <title>停车场信息</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="css/parkLotInfo.css">
</head>
<body>
<div class="title">
    <img class="title-img" src="./images/top_title5@2x.png" alt="">
    <div class="time-sign">
        <p><span class="current-time">2020年5月23日 星期六</span> <span class="today-weather">晴天</span></p>
        <!--  <p class="level-explain">
              <span>保驾等级: XXX</span>
              <span>运行图: XXXX</span>
          </p>-->
    </div>
</div>
<div class="content-box clearfix">
    <div class="left-content">
        <div class="type-title">车辆当班信息</div>
        <div id="leftCar" class="car-box">
            <ul class="car-list" id="userList">
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>

                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/user_pic.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场值班长</h4>
                        <div class="user-info">
                            <span>姓 <i></i> 名：</span>
                            郝 军
                        </div>
                        <div class="phone-info">
                            <span>电话号码：</span>
                            5662321
                        </div>
                    </div>
                </li>
            </ul>
            <div class="no-data">暂无数据</div>
        </div>
    </div>
    <div class="middle-img">
        <div class="img-bg"><img src="./images/pic@2x.png" alt=""></div>
    </div>
    <div class="right-content">
        <div class="type-title base-info">车场基本信息</div>
        <div id="rightCar" class="car-box">
            <ul class="car-list">
                <li>
                    <div class="img-head">
                        <img src="./images/pic01@2x.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>停车股道</h4>
                        <div class="user-info Tcgd">
                            停车列检库1-15A、1-15B、16A共计可停放31列车
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/pic02@2x.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>检修股道</h4>
                        <div class="user-info Jxgd">
                            停车列检库16B、17A、17B、18A、19A、20A、21A 共计可停放5列车
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/pic03@2x.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场道岔</h4>
                        <div class="user-info Ccdc">
                            停车列检库1-15A、1-15B、16A共计可停放31列车
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/pic04@2x.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>车场信号机</h4>
                        <div class="user-info  Ccxhj" >
                            停车列检库16B、17A、17B、18A、19A、20A、21A 共计可停放5列车
                        </div>
                    </div>
                </li>
                <li>
                    <div class="img-head">
                        <img src="./images/pic05@2x.png" alt="">
                    </div>
                    <div class="car-info">
                        <h4>无接触网线路</h4>
                        <div class="user-info  Wjcwxl">
                            停车列检库1-15A、1-15B、16A共计可停放31列车
                        </div>
                    </div>
                </li>

            </ul>
        </div>
    </div>

</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="js/common.js"></script>
<script>
    var timer=null;
    var ws=null;//WebSocket实例
    $(function () {
        /***********隐藏滚动条***********/
        $("#leftCar").mCustomScrollbar({
            theme:"minimal"
        });
        $("#rightCar").mCustomScrollbar({
            theme:"minimal"
        });

        let testObj={
            "ccjbxxList": {
            "ccxhj": "D1-D30,X1-X24,S1-24",
                  "ccdc": "1-26道岔",
                  "tcgd": "停车列检线1-15A，1-15B,16A共计可停放31列车",
                  "jxgd": "停车列检线16A，17B，18A，18B共计可停放4列车",
                  "wjcwxl": "21G-24G"
        },
            "cldbxxList": [
            {
                "name": "张善",
                "position": "车场值班长",
                "phone": "14781724614",
                "bz": "管理一组"
            },
            {
                "name": "张思",
                "position": "运转值班员",
                "phone": "14781724614",
                "bz": "管理一组"
            },
            {
                "name": "张吴",
                "position": "设备值班员",
                "phone": "14781724614",
                "bz": "管理一组"
            },
            {
                "name": "张柳",
                "position": "信号楼值班员",
                "phone": "14781724614",
                "bz": "管理一组"
            },
            {
                "name": "张启",
                "position": "信号楼值班员",
                "phone": "14781724614",
                "bz": "管理一组"
            },
            {
                "name": "张巴",
                "position": "信号楼值班员",
                "phone": "14781724614",
                "bz": "管理一组"
            }
        ]
        }
        bindData(JSON.stringify(testObj))
        addWebSocket();//默认执行第一次
        timer=setInterval(function () {//根据状态判断时候重新建立连接
            if(ws.readyState!=1){//未连接
                addWebSocket()
            }
        },1000)
        let h = window.innerHeight;
        let w = 120;
        if (window.innerWidth < 1920) {
            if (window.innerWidth == 1600) {
                w = 100
            } else if (window.innerWidth == 1440) {
                w = 90
            } else if (window.innerWidth == 1366) {
                w = 85
            }
        }
        let carH=h - w - 110
        document.querySelector('#rightCar').style.height = carH+ 'px'
         $('#rightCar li').css('height',carH/5 + 'px')
        document.querySelector('#leftCar').style.height = carH + 'px'
         $('#leftCar li').css('height',carH/5 + 'px')

     /*   $(".no-data").css("display","block")
        $("#userList").css("display","none")*/
    })

    function addWebSocket() {
        ws = new WebSocket("ws://localhost:8080/DTCGCW/ZhWebSocket.ws?cdid="+cdidx+'connectType=0');
        let receiveMsg='';
        ws.onopen = function(){//连接成功
            ws.send(JSON.stringify({'head':'GetHomePageData',message:''}))
        };
        ws.onmessage = function(evt) {//接收数据
            console.log( "Received Message: " + evt.data);
            $(".no-data").css("display","none")
            $("#userList").css("display","block")
            let receiveMsg='';
            if(evt.data==='开始'){
                receiveMsg=''
            }
            if(evt.data.indexOf('结束')>-1){
                bindData(receiveMsg)
            } else {
                receiveMsg +=evt.data;

            }
        };
        ws.onclose = function(evt) {
        };
        ws.onerror = function () {
            $(".no-data").css("display","block")
            $("#userList").css("display","none")
           // console.log('连接错误，请稍后再试');
        };
    }
    function bindData(str) {//渲染table
        let dataObj=JSON.parse(str)
        console.log(dataObj)
        let arr=dataObj.cldbxxList;//车辆当班信息集合
        $(".Tcgd").text(dataObj.ccjbxxList.tcgd)//停车股道信息
        $(".Ccxhj").text(dataObj.ccjbxxList.ccxhj)//车场信号机信息
        $(".Ccdc").text(dataObj.ccjbxxList.ccdc)//车场道岔信息
        $(".Jxgd").text(dataObj.ccjbxxList.jxgd)//检修股道信息
        $(".Wjcwxl").text(dataObj.ccjbxxList.wjcwxl)//无接触网线路
        let tableStr=''
        for (let i=0;i<arr.length;i++){
            tableStr+=`<li>
                            <div class="img-head"> <img src="./images/user_pic.png" alt=""></div>
                              <div class="car-info">
                                <h4>车场${arr[i].position}</h4>
                                <div class="user-info">
                                    <span>姓 <i></i> 名：</span>
                                        ${arr[i].name}
                                </div>
                                <div class="phone-info">
                                    <span>电话号码：</span>
                                     ${arr[i].phone}
                                </div>
                            </div>
                       </li>`
        }
        console.log(tableStr)
        $("#userList").html(tableStr)
    }
</script>
</html>
