<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <title>综合信息发布</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="css/overviewInfo.css">
</head>
<body>
<div class="title">
    <img class="title-img" src="./images/top_title3@2x.png" alt="">
    <div class="time-sign">
        <p>2020年5月23日 星期六 晴天</p>
        <p class="level-explain">
            <span>保驾等级: XXX</span>
            <span>运行图: XXXX</span>
        </p>
    </div>
</div>
<div class="table-box">
    <div class="item">
        <div class="item-title">计划<br/> 施工<br/> 情况</div>
        <div class="item-content">
            <table class="table-title">
                <thead>
                <tr>
                    <th width="5%">序号</th>
                    <th width="5%">施工编号</th>
                    <th width="10%">施工时间</th>
                    <th width="7.5%">施工单位</th>
                    <th width="12.5%">施工地点</th>
                    <th width="10%">施工内容</th>
                    <th width="10%">是否停电</th>
                    <th width="10%">是否封锁</th>
                    <th width="30%" >目前情况</th>
                </tr>
                </thead>
            </table>
            <div id="planTable" class="table-body">
                <table>
                    <thead>
                    <tr>
                        <th width="5%">序号</th>
                        <th width="5%">施工编号</th>
                        <th width="10%">施工时间</th>
                        <th width="7.5%">施工单位</th>
                        <th width="12.5%">施工地点</th>
                        <th width="10%">施工内容</th>
                        <th width="10%">是否停电</th>
                        <th width="10%">是否封锁</th>
                        <th width="30%" >目前情况</th>
                    </tr>
                    </thead>
                    <tbody id="planBody">
                    <tr>
                        <td>1</td>
                        <td>0401</td>
                        <td>2020-05-01</td>
                        <td><div>成都</div></td>
                        <td><div>成都</div></td>
                        <td><div>这是事故内容</div></td>
                        <td><span class="yes">是</span></td>
                        <td><span>是</span></td>
                        <td><div class="comment">TTTTTTTTTT</div></td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>0401</td>
                        <td>2020-05-01</td>
                        <td><div>成都</div></td>
                        <td><div>成都</div></td>
                        <td><div>这是事故内容</div></td>
                        <td><span class="yes">是</span></td>
                        <td><span>是</span></td>
                        <td><div class="comment">TTTTTTTTTT上帝就发哈卡号富士康黑客技术大法官汇款的方式阿斯顿覅贺卡世界的繁华爱上对方会i撒野的发票破案速度法破案苏菲的【USAF</div></td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="item">
        <div class="item-title">日常<br/> 及<br/> 临时<br/> 施工<br/> 情况</div>
        <div class="item-content">
            <table class="table-title">
                <thead>
                <tr>
                    <th width="5%">序号</th>
                    <th width="5%">施工编号</th>
                    <th width="10%">施工时间</th>
                    <th width="7.5%">施工单位</th>
                    <th width="12.5%">施工地点</th>
                    <th width="10%">施工内容</th>
                    <th width="10%">是否停电</th>
                    <th width="10%">是否封锁</th>
                    <th width="30%" >目前情况</th>
                </tr>
                </thead>
            </table>
            <div id="commonTable" class="table-body" >
                <table>
                    <thead>
                    <tr>
                        <th width="5%">序号</th>
                        <th width="5%">施工编号</th>
                        <th width="10%">施工时间</th>
                        <th width="7.5%">施工单位</th>
                        <th width="12.5%">施工地点</th>
                        <th width="10%">施工内容</th>
                        <th width="10%">是否停电</th>
                        <th width="10%">是否封锁</th>
                        <th width="30%" >目前情况</th>
                    </tr>
                    </thead>
                    <tbody id="commonBody>
                          <tr>
                              <td>1</td>
                              <td>0401</td>
                              <td>2020-05-01</td>
                              <td><div>成都</div></td>
                              <td><div>成都</div></td>
                              <td><div>这是事故内容</div></td>
                              <td><span class="yes">是</span></td>
                    <td><span>是</span></td>
                    <td><div>TTTTTTTTTT</div></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="item">
        <div class="item-title">调车<br/> 及<br/> 洗车 <br/>作业 <br/>情况</div>
        <div class="item-content">
            <table class="table-title">
                <thead>
                <tr>
                    <th width="5%">序号</th>
                    <th width="5%">施工编号</th>
                    <th width="10%">施工时间</th>
                    <th width="7.5%">施工单位</th>
                    <th width="12.5%">施工地点</th>
                    <th width="10%">施工内容</th>
                    <th width="10%">是否停电</th>
                    <th width="10%">是否封锁</th>
                    <th width="30%" >目前情况</th>
                </tr>
                </thead>
            </table>
            <div id="washTable" class="table-body" >
                <table>
                    <thead>
                    <tr>
                        <th width="5%">序号</th>
                        <th width="5%">施工编号</th>
                        <th width="10%">施工时间</th>
                        <th width="7.5%">施工单位</th>
                        <th width="12.5%">施工地点</th>
                        <th width="10%">施工内容</th>
                        <th width="10%">是否停电</th>
                        <th width="10%">是否封锁</th>
                        <th width="30%" >目前情况</th>
                    </tr>
                    </thead>
                    <tbody id="washBody">
                    <tr>
                        <td>1</td>
                        <td>0401</td>
                        <td>2020-05-01</td>
                        <td><div>成都</div></td>
                        <td><div>成都</div></td>
                        <td><div>这是事故内容</div></td>
                        <td><span class="yes">是</span></td>
                        <td>xxxxxx</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
<script>
    $(function () {
        /***********隐藏滚动条***********/
        $("#planTable").mCustomScrollbar({
            theme:"minimal"
        });
        $("#commonTable").mCustomScrollbar({
            theme:"minimal"
        });
        $("#washTable").mCustomScrollbar({
            theme:"minimal"
        });
        let fontSize=Number.parseInt(((document.body.clientWidth)*16)/1920)+'px'
        $("html").css({'font-size':fontSize})

        let h = window.innerHeight;
        let w = 120;
        if (window.innerWidth < 1920) {
            if (window.innerWidth == 1600) {
                w = 100
            } else if (window.innerWidth == 1440) {
                w = 90
            } else if (window.innerWidth == 1366) {
                w = 85
            }
        }
        let boxH=Number.parseInt((h - w - 200 )/3)

        $("#planTable").css('height',boxH+'px')
        $("#commonTable").css('height',boxH+'px')
        $("#washTable").css('height',boxH+'px')
        var timer=null;
        timer=setInterval(function () {
            addWebSocket('{\'head\':\'GetPlanBuildData\',message:\'\'}')  //计划施工数据
        },1000)
    })


    })
    function addWebSocket(obj,type) {
        var ws = new WebSocket("ws://localhost:8080/DTCGCW/ZhWebSocket.ws?cdid="+cdidx+'connectType=0');
        ws.onopen = function(){//连接成功
            ws.send(obj)
        };
        ws.onmessage = function(evt) {//接收数据
            console.log( "Received Message: " + evt.data);
            if(evt.data==='开始')return
            if(evt.data.indexOf('结束')!=-1){
                return
            }else{
                let strList=''
                strList +=evt.data;
                if(type==0){
                    bindData(strList)
                }else if(type==2){
                    bindCommonData(str)
                }else if(type==3){
                    washCommonData(str)
                }
            }
        };
    }
    function bindData(str) {//渲染table
       // let arr=JSON.parse(str)
        let arr=[
            {
                "buildNo": "SG-002",
                "buildDate": "2020-06-05 09:12:12",
                "buildUnit": "检修二组",
                "buildAddress": "L-5A,L-5B",
                "buildContent": "股道维护",
                "isPowerCut": "否",
                "isBlockade": "否",
                "currentSituation": "已开工"
            }
        ]
        let tableStr=''
        for (let i=0;i<arr.length;i++){
            let className=''
            let classNameTwo=''
            if(arr[i].isPowerCut==='是'){
                className='yes'
            }
            if(arr[i].isBlockade==='是'){
                classNameTwo='yes'
            }
            tableStr+=`<tr>
                           <td>${i+1}</td>
                           <td>${arr[i].buildNo?arr[i].buildNo:''}</td>
                           <td>${arr[i].buildDate?arr[i].buildDate:''}</td>
                           <td>${arr[i].buildUnit?arr[i].buildUnit:''}</td>
                           <td><div class="time">${arr[i].buildAddress?arr[i].buildAddress:''}</div></td>
                           <td><div class="time">${arr[i].buildContent?arr[i].buildContent:''}</div></td>
                             <td><span class=${className}>${arr[i].isPowerCut}</span></td>
                             <td><span class=${classNameTwo}>${arr[i].isBlockade}</span></td>
                           <td >
                               <a class="comment">${arr[i].currentSituation?arr[i].currentSituation:''}</a>
                           </td>
                       </tr>`
        }
        $("#planBody").html(rtable)
    }
    function bindCommonData(str) {//日常
       // let arr=JSON.parse(str)
        let tableStr=''
        let arr=[
            {
                "buildNo": "SG-002",
                "buildDate": "2020-06-05 09:12:12",
                "buildUnit": "检修二组",
                "buildAddress": "L-5A,L-5B",
                "buildContent": "股道维护",
                "isPowerCut": "否",
                "isBlockade": "否",
                "currentSituation": "已开工"
            }
        ]
        for (let i=0;i<arr.length;i++){
            let className=''
            let classNameTwo=''
            if(arr[i].isPowerCut==='是'){
                className='yes'
            }
            if(arr[i].isBlockade==='是'){
                classNameTwo='yes'
            }
            tableStr+=`<tr>
                           <td>${i+1}</td>
                           <td>${arr[i].buildNo?arr[i].buildNo:''}</td>
                           <td>${arr[i].buildDate?arr[i].buildDate:''}</td>
                           <td>${arr[i].buildUnit?arr[i].buildUnit:''}</td>
                           <td><div class="time">${arr[i].buildAddress?arr[i].buildAddress:''}</div></td>
                           <td><div class="time">${arr[i].buildContent?arr[i].buildContent:''}</div></td>
                             <td><span class=${className}>${arr[i].isPowerCut}</span></td>
                             <td><span class=${classNameTwo}>${arr[i].isBlockade}</span></td>
                           <td >
                               <a class="comment">${arr[i].currentSituation?arr[i].currentSituation:''}</a>
                           </td>
                       </tr>`
        }
        $("#commonBody").html(rtable)
    }
    function washCommonData(str) {//调车及洗车
        let arr=JSON.parse(str)
        let tableStr=''
        for (let i=0;i<arr.length;i++){
            tableStr+=`<tr>
                           <td>${i+1}</td>
                           <td>${arr[i].trainNumber?arr[i].trainNumber:''}</td>
                           <td>${arr[i].planTrainNo?arr[i].planTrainNo:''}</td>
                           <td>${arr[i].stationTrack?arr[i].stationTrack:''}</td>
                           <td><div class="time">${arr[i].planOutDate}</div></td>
                            <td>${arr[i].realTrainNo?arr[i].realTrainNo:''}</td>
                             <td><div class="time">${arr[i].realOutDate?arr[i].realOutDate:''}</div></td>
                           <td >
                               <a class="comment">${arr[i].remark?arr[i].remark:''}</a>
                           </td>
                       </tr>`
        }
        $("#washBody").html(rtable)
    }

</script>
</html>
